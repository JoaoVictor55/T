name: Compilar LaTeX e Publicar PDF

# Dispara o workflow em todo push para o branch principal (main/master)
on:
  push:
    branches:
      - main
      - master

# Define o conjunto de jobs que serão executados
jobs:
  build_latex:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout do Repositório
        uses: actions/checkout@v4

      - name: Compilar LaTeX e Instalar Pacotes
        uses: xu-cheng/latex-action@v2
        with:
          root_file: main.tex 
          compiler: latexmk
          # Use -xelatex para suporte a fontes e unicode
          args: -pdf -xelatex
          
          # Use 'extra_packages' para pacotes TeX Live (nomes tlmgr)
          extra_packages: >
            biblatex 
            titlesec
          # Removido 'extra_system_packages' para evitar conflito no Alpine Linux
          
      - name: Upload do PDF Compilado como Artefato
        uses: actions/upload-artifact@v4
        with:
          name: main.pdf # NOME DO ARTEFATO: Deve ser o mesmo no download
          path: main.pdf # Caminho do arquivo PDF gerado
          
  deploy_pages:
    needs: build_latex # Este job só roda após a compilação (build_latex)
    # Permissões necessárias para usar GitHub Pages
    permissions:
      pages: write     
      id-token: write  

    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}

    runs-on: ubuntu-latest
    steps:
      - name: Baixar o Artefato main.pdf
        uses: actions/download-artifact@v4
        with:
          name: main.pdf # Deve coincidir exatamente com o nome do upload acima
          path: ./temp-pdf
          
      - name: Configurar Pages e Mover PDF
        run: |
          # O GitHub Pages serve a pasta 'public'
          mkdir public
          # Move o PDF baixado para o local de publicação e o renomeia para index.pdf (URL raiz)
          cp ./temp-pdf/main.pdf public/index.pdf 

      - name: Upload do Pages Artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: ./public # Faz o upload da pasta 'public'

      - name: Deploy para GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4